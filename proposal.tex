\chapter{Architectural Contributions} \label{chap:arch-proposal}

\section*{}

The objective of this section is to explain and state some suggestions about what is possible to do in the next two or three years, in order to achieve some kind of interoperability and sharing, with the aim of improving the healthcare services in Portugal. In this sense, the goal is not to predict the future about the health information systems or to propose intangible milestones but to point out some strategies that might help to create value in the mid-term future without precluding future requirements and evolutions.

This chapter is meant to explain the progresses that were made since this dissertation work was initiated by February. However, there was a previous work of studying architectures and standards and also understanding the new government's strategy that was done since November. The work was done in a close cooperation with CIC in terms of researching and discussing the best options to take. It will start explaining the work methodology between all the team, advancing then into the explanation of what was found to be more or less relevant. Finally, we explain for each project what were the contributions and what might be done in the future to help the Portuguese EHR to grow healthy and robust. Along the different sections, the authors explain the developments made under this collaboration and also the vision proposed to the mid-term future.

\section{Methodology}

The methodology was based on a relation of great cooperation between the team and the responsible entities, namely CIC, ACSS and SPMS. The meetings were in a weekly basis counting more than forty since November. The FEUP team's role was to support the design and implementation process, helping in the process of taking decisions, discussing the multiple options and bringing new solutions to the table.

\section{Strategic vision}

The CIC opted by a strategy based on several projects and new processes running at the same time, instead of one with long study, research phases and long implementations schedules. This agile strategy led to the creation of 4 projects, which has different goals but are strongly connected to the creation of an EHR:

\begin{itemize}
\item Personal Health Records -- website that is supposed to has the functionalities of a normal PHR, letting the patient to introduce clinical information and give consent for it to be accessed by healthcare professionals. The Patient Portal already existed but was added to it a new module called \textit{\textbf{As minhas notas}}; 
\item epSOS integration -- website to provide the integration with the epSOS project, providing the possibility of send a patient summary abroad or to receive clinical data about a foreign patient. The project was named \textit{\textbf{Portal Internacional}};
\item Patient Summaries -- platform to support the existence of a single clinical summary for each patient, containing the most important information about him/her. The Portuguese project was called \textbf{\textit{Resumo Clínico Único do Utente (RCU2)}};
\item Information sharing among institutions -- the \textbf{\textit{Plataforma de Dados de Saúde (PDS)}} with the aim of connect the projects above and providing the access that the professionals need to the referred information.
\end{itemize}



\section{Principles}

The goal of defining some principles is to serve as guidelines for the architecture being developed. This concept is used in the TOGAF methodology~\citep{Josey2009, Josey2011}. These principles intent to give a premature vision of what might be the development process and the changes that the institutions will have to face.

%TODO armonizar explicação de acrónimos.. ou footnotes ou entre ()

\subsection{Favour the quick-wins}

\subsubsection{Statement}
The difficult times that Portugal are passing through imply the search for solutions with short-term results and value. In this sense, there is an emergent need for balancing the best solution and the reasonable solution with short-term benefits.
\subsubsection{Rationale}
The project's scope and complexity obliges the definition and search for solutions that might motivate all the stakeholders. Since there are an huge number of interested parties, the quick-wins are a big help in order to raise interest and contributions to the project. On the other hand, the definition of short-term milestones help to keep control of the progress. Most of the healthcare institutions are big structures with several difficulties to respond to change in time and the others are not simply not used to do it.
\subsubsection{Implications}
This strategy obliges the organizations to gain some flexibility. Also, the search for quick-wins may fare worse then solutions without so much rapid benefits. 


\subsection{Normalize the data}

\subsubsection{Statement}
The normalization path seems inevitable. Accordingly, this proposal should privilege and encourage the adoption and evolution of the systems, instead of creating several solutions according with each existing system.
\subsubsection{Rationale}
The advantages of normalizing data, processes or any other kind of action are recognized and consensual. In fact, with the systems growing up exponentially in number and complexity, the need for sharing data has increased as well, creating a context where a system should be able to communicate and exchange data with thousands of others. The definition of norms for representing the data allows an healthcare institution to much easily receive and interpret data from one other.
\subsubsection{Implications}
The change of information systems that are not prepared to be expanded might be very slow and complex, in most cases. Also, there is a need for changing the processes, unifying them, and that change might be more difficult than previous one. Moreover, there will be a necessity for defining national unified models for documents like discharge letters, analysis and so on.


\subsection{Adopt international standards}

\subsubsection{Statement}
There are numerous health standards ready to be used and facilitate sharing and exchanging of clinical information. The new services should adopt a standard and the old ones should be converted.
\subsubsection{Rationale}
Most of the times, the standards can not be directly applied to the Portuguese reality. That is, the national systems are using national codifications which simply can not be substituted. In that case, the solution might be to create ways of translate between the two codifications.
\subsubsection{Implications}
There will be necessary to define conversion tables or services between the national and international codifications. These kind of work should be supervised and controlled at the Ministry level in order to align all the institutions.


\subsection{Search for flexible solutions}

\subsubsection{Statement}
With such a long process, there are several decisions that have to be made late in the process of implementation. In that situations, the decisions should consider the solutions that will allow the system to evolute easily.
\subsubsection{Rationale}
Most of times, the search for flexible solutions have high costs in terms of implementation schedule. Certainly, there is a need for balancing the level of flexibility that the solution might search for. Usually, the better solutions take more time to be designed and adopted. Moreover, flexible solutions are often more complex and heavy than others. In this context, the key is always the capacity for balancing both perspectives.
\subsubsection{Implications}
The search for flexible solutions may require more resources and more time to implement the projects.


\subsection{Fit without precluding}

\subsubsection{Statement}
The strategy is not to replace the existing systems but to fit them trying not to compromise future requirements and developments.
\subsubsection{Rationale}
Most of the systems in use were created several years ago. That is, every healthcare professional is accustomed to the existing systems and that a sudden and unprepared change to the way they have to work and do their job might sentence the project's failure.
\subsubsection{Implications}
It will be necessary to understand which systems are fundamental to the business goals, meaning that might be some systems which does not worth to integrate with, either because they are too old and will be deprecated soon or because they simply have not enough audience.






\section{The Portuguese Personal Health Record}

As described at Section~\ref{sec:phr} the PHR system may be an important component to the successful implementation of an EHR. In the section, the goal is to state the recent developments made under this assumption but also to understand which are the next steps that need to be taken.

\subsection{Recent developments}

It is important to notice the introduction of the Patient Portal that centralizes all the patients' information across the country, in the same system.

To the existing Patient Portal was added a new section called "My Notes". This section pretends to be a PHR system. For now, the portal allows an individual to input the following information: emergency contacts, health information (height, weight, blood glucose, or blood pressure), lifestyle, health problems, allergies and medications. As stated at the service, the objective is to allow the citizen to have an active role in managing, promoting and improving its health state.

The system also allows the individual to give or withdraw the consent to share the information among the public healthcare institutions.

\subsection{Future vision}

\mycustomcaptionfigure{PHR_architecture}{Overview of the Portuguese PHR system which was integrated with \textit{Portal do Utente}. The system might stand alone as an repository providing some essential services as described in the figure.}{width=0.8\textwidth}{Overview of the Portuguese PHR system}

This is the kind of system that can be built almost standalone (see Fig.~\ref{fig:PHR_architecture}). In fact, it was developed as a new peace of software, despite of the integration with the RNU login services. Actually, in addition to storing personal information and allowing the consent managing, it also allows the patient to access the professionals list who saw his/her notes.

Despite of having some interesting features already, the system still has a large margin to evolve. One of the features that should be improved is the patient consent. The actual consent only has to options:
\begin{enumerate}
\item give or not give access to the self-introduced records at the Patient Portal - My Notes by a healthcare professional;
\item give or not give access to the existing information stored at the several institutions of the Portuguese National Health Service by a healthcare professional.
\end{enumerate}

Probably it will be necessary to have a more detailed consent, providing more options like, for instance: give consent only in case of an emergency or only to institutions within a determined country region.

In terms of information and new functionalities, there are several examples of what could also be included. The authors believe that the following are good examples:
\begin{itemize}
\item important events, dates and hereditary conditions in the family history;
\item vaccines administrated and vaccines still to be administrated and their dates;
\item organ donor authorization.
\end{itemize}


Last but not least, the information does not worth anything unless it can be shared and access by the professionals. In that sense, if the collected data is not saved in an appropriate format there will be necessary too much effort to share it. So, it is fundamental to use a standard to store the information as well as to implement the interfaces and services that will allow that exchange.


\section{The Portuguese Patient Summary}

The Patient Summary (see Sec.~\ref{sec:pat_sum}) stands as an essential concept of an EHR. In the next few sections, the authors describe the main developments recently done but also the work that is still to be done in order to improve the service quality.

\subsection{Recent developments}

The Portuguese Patient Summary (PS) project which was called the RCU2 - Resumo Clínico Único do Utente (Patient Single Clinical Summary) is certainly the most important component. In fact, as described in Section \ref{sec:pat_sum}, the PS might turn into to the enabler necessary to mobilize the institutions and get them to adopt standards and normalize processes.

The development of the RCU2 raised several questions. Those are the issues that are described in the following subsections.

\subsubsection{The repository}

Where to store the information? Firstly, the question of the RCU2 physical location was a very complex one. As the clinical information is produced at healthcare institutions, there were some reservations about the possibility of gathering it and centralizing it. In fact, when consulting the CNPD -- Comissão Nacional de Proteção de Dados (National Committee for Data Protection) -- the reservations were confirmed. The CNPD did not allow the creation of a national RCU2 repository and obliged it to be distributed at the primary healthcare institution, where the patient has its family doctor.

The problem is that the CSP -- Cuidados de Saúde Primários (Primary Healthcare) -- institutions are not equipped with the necessary infrastructure to support and provide the RCU2 service, either because the servers are just to old, not secure enough or the bandwidth is not adequate.

In that way, a possible solution is to store the data at each ACES -- Agrupamentos de Centros de Saúde (Healthcare Primary Institutions Groups). The ACES are defined as groups of CSP institutions and thus they are a lot less, smoothing not only the implementation effort but also the support and upgrading processes. However, the ideal solution would be to create a repository for each of the five ARS -- Administração Regional de Saúde (Regional Health Administration), bringing the following advantages:
\begin{itemize}
\item easiness of supporting and upgrading the systems;
\item facility to secure and guarantee data confidentiality;
\item still being a distributed system, despite of being much smaller;
\item division of responsibilities among the ARS instead of centralizing them at the Ministry.
\end{itemize}



\subsubsection{The required information}

Which information and where to collect it from? The question about the information to be present in the RCU2 was another fundamental one. In this case, the work done by the CIC -- Comissão para a Informatização Clínica (Commission for Clinical Informatics) -- in cooperation with the FEUP team, was based on two concerns:
\begin{itemize}
\item involving the clinicians asking them to identify which information is more crucial and brings more value;
\item trying to match the RCU2 data with the data required and suggested to the epSOS PS.
\end{itemize}
In the early stages, the data available will be restricted to the data available at the existing information systems. Notwithstanding, the data identified as useful, which is not available at the systems yet, must be considered to the next phases of the project.

Most of the information selected to be part of RCU2 is present in the CSP units. Although, the hospital episodes are also a relevant source of clinical data, specially regarding procedures, allergies and prescriptions. In the context, the discharges letters produced, which synthesize the events held indoors, are the easiest way to transfer the data to the RCU2. Nevertheless, to enable this exchange the hospitals need to produce the discharge letters:
\begin{enumerate}
\item in a digital format instead of using paper -- something that still happens in some institutions;
\item using a model defined at national level in order to normalize them.
\end{enumerate}


%The process of transforming the locally stored information into GDH compliant data might modify and discredit it.
%The time period of one month to have the data centralized and normalized might be too large.

%Have the primary healthcare institutions the capability to host and provide that information? Which uptime and availability levels are we talking about?
%The Patient Summary (RCU2) information will be stored where?

%The plan is that each primary healthcare institution would be responsible to host the Patient Summary information about their affected patients.

%Quais são as estruturas de dados necessárias para suportar os processos ? Qual a sua estrutura lógica e física ? Que tipo de protecção necessita ? Como é organizada, onde está localizada e como alimenta as diversas aplicações que suportam os processos ? Como detectamos e eliminamos as redundâncias ?

%TODO ir buscar info aos webgdhs
%TODO ou usar webgdhs.. explicar melhor

In a parallel work, there was the need of defining the new data model for the RCU2 (the Patient Summary system). In a team effort it has been defined a database model that is be able to store the RCU2 information. The model can be found at Appendix~\ref{ap1:rcu2_db}.

The model was conceived with two main concerns:
\begin{itemize}
\item Approximate the data model to the existing representation in the healthcare primary care units in order to facilitate the data transfer;
\item Build a RCU2 model based on the epSOS Patient Summary information recommendations and requirements in order to facilitate the data export and dispatch to other countries by epSOS platform.
\end{itemize}

The referenced model will be tried out at the primary healthcare institutions.


\subsubsection{The synchronization process}

How often is the data transferred between the healthcare institutions to the RCU2? Is it immediate? Daily? Weekly? Since we have defined which data will constitute the RCU2 and where it comes from, it is necessary to determine on which basis the RCU2 will be updated. That synchronization may occur immediately when the information arrives at the local information system or it may be exchanged with a determined frequency (e.g. daily, weekly, monthly, etc).
The information has to flow between different institutions. Mainly, it has to be transferred between the hospitals or others CSP institutions to the CSP unit where the RCU2 to that specific patient is stored. The process could be described as it follows (see Fig. \ref{fig:PDSi1-Alta}):

\myfigure{PDSi1-Alta}{The flow of a discharge letter between the hospital and the CSP unit}
\begin{itemize}
\item the general practitioner introduces the discharge letter into the information system;
\item the information system dispatches the data to a PDS receiver;
\item the patient identification is checked against the RNU and is returned the correspondent CSP;
\item the data is forwarded to the CSP institution;
\item if requested, the data shall also be sent to another national institutions but not without making it anonymous.
\end{itemize}

In terms of the standard recommended to export the RCU2 to others institutions, the HL7 CDA (Section~\ref{sec:hl7-cda}) appears to be the best option:
\begin{itemize}
\item sufficiently recent to be actual but sufficient old to be mature;
\item standard used within the epSOS project;
\item evolution of HL7 V2 which might be used to transfer the event data;
\item international well-known standard.
\end{itemize}

\subsubsection{The management process}

Will it be automatically managed or will exist anyone responsible to manage it? If so, who will be that person? When describing the PS concept (Section \ref{sec:pat_sum}) was possible to recognize the importance of being the doctors to manage the PS in the Scottish case study. In fact, a model completely automated to integrate and validate the information would bring two essential issues:
\begin{enumerate}
\item discredit and distrust about the information;
\item difficulties dealing with conflicting information from different institutions.
\end{enumerate}

In this sense, it was defined that would be the family doctor to manage the RCU2. That means that each general practitioner is responsible to administer the registries of their patients, allowing them to hide deprecated information and accept or reject proposals for new data. Clearly, this strategy brings new liabilities and charges to the doctors that might have an huge impact in their daily work. In that sense, this approach has to be carefully communicated in order to get sufficient acceptance by the professionals.







%TODO \textbf{How will it be accessed and consulted?}
%The existence of a PS opens several possibilities of utilization in many different situations.


\subsection{Future Vision}

The recommendations presented in the next subsections are centred in three fundamental questions: the location of the data; the codification of the data and the process that allows the data to be uploaded from the local institutions to the repository above. A summary of the architecture can be found at Figure~\ref{fig:RCU2_architecture}.

\mycustomcaptionfigure{RCU2_architecture}{A summary of the future vision for the RCU2. This project will be interconnect with two kind of institutions: hospitals and CSP. Also, it will be constituted by the referred main components with well-defined services to retrieve data.}{width=0.8\textwidth}{A summary of the future vision for the RCU2}

\subsubsection{The repository}

Regarding the RCU2, the natural tendency is to group the several institutions by regions and trying to have as few instances as possible. This policy of centralization has great advantages in terms of ease of troubleshooting, improvements, maintenance, etc. 


\subsubsection{The information}

The use of a standard to store clinical information is often the first solution to evaluate. Even with respect to the RCU2, the possibility of migrating the data model to a standard like HL7 RIM, must not be discarded. However, it seems impossible in the medium-term future to completely apply a standard to it. There are several reasons to that, but the most prominent one is the effort that it would require to change the existing systems in order to exchange data like that.
Also, since that the systems are not likely to be substituted in the mid-term future, it is a lot easier to store it in the original format at RCU2. Obviously, when sending that data abroad, it has to be transformed and transcoded to the international standards. Nevertheless, that is a different question of how the information is transferred between institutions, not how it is stored. 


\subsubsection{The synchronization process}

The synchronization process has to be analysed in two different contexts: the hospitals and the CSP. About the hospitals, the GDH repository could be used to retrieve information from the hospitals to the RCU2. However, as stated earlier in this document (Section~\ref{sec:hosp_data}), it could bring problems of confidence in the information. On the other hand, this system has the information codified which has a great advantage since it would allow to integrate that information much quicker and with fewer effort. The other alternative would be to modify the existing systems.

The situation of the CSP unit is quite different. In this case, it will be necessary to build a infrastructure to keep the temporary information and dispatch it daily.

%TODO melhorar


\section{The epSOS integration}

The goal of this section is to describe the work realised under the epSOS integration process.

\subsection{Recent developments}

As described in Section~\ref{sec:epsos}, the epSOS project is based on two essential services (Patient Summary and ePrescription) but Portugal was integrated only with the PS sharing commitment. Since the epSOS integration is very dependent on the evolution of the other projects, particularly on the RCU2, there was no significant developments on it. Despite of the Portuguese NCP implementation process is at the responsibility of an external company, there was a close work between the company and the SPMS, in which the authors also have participated. The results of that close collaboration are described in the next section, helping to define the future vision.

\subsection{Future vision}

The epSOS project may become an important catalyst to the introduction of standards and the normalization of data. As saw in Section~\ref{sec:epsos}, the integration within the epSOS context requires the use of specific standards, namely HL7 CDA v2 (Sec.~\ref{sec:hl7-cda}). In that sense, it will be required that Portugal has the capability to send information in specific formats. The epSOS definition is based on two use cases:
\begin{itemize}
\item Case A -- provide information about a Portuguese citizen who is at an European healthcare institution;
\item Case B -- receive information about a foreign citizen from its own country;
\end{itemize}


\subsubsection{Case A}

If we will be sending the RCU2 codified with HL7 CDA, it may be interesting to start sharing it the same way internally. In order to achieve that, it will be necessary to bring the National Connector (see Section~\ref{sec:epsos_ni}) into the scope of PDS instead of staying as a service created only to epSOS. The next components seems to be fundamental:
\begin{itemize}
\item locate the National Connector, which could have the responsibility to transcode from RCU2 to HL7 CDA, within the PDS scope;
\item define the services using the standards (e.g. IHE profiles, see Section~\ref{sec:ihe}).
\end{itemize}

This way, it will be possible to share the standardized RCU2 not only to other countries but to several institutions, namely the private ones. Another important note is the existing dependency between this case and the \textit{Portal do Utente} in order to confirm the patient consents.

\mycustomcaptionfigure{epSOS_architecture}{General view of the epSOS components. The components represented are only the ones that directly interact with the creation and dispatch of the PS}{width=0.6\textwidth}{General view of the epSOS components only with respect to the PS providing}

\subsubsection{Case B}

In order to access the clinical information of a foreign patient, the CIC decided to create a new project called \textit{Portal Internacional}\footnote{International Portal}. This website would allow every authenticated and authorized professional to access some PS in a Portuguese healthcare institution event context. However, there is a really big problem: the absence of a Nation Healthcare Professional Record and consequently of an Authentication Provider, which the authors explore more in detail at Section~\ref{sec:hpip}. A general view of the components is presented at Figure~\ref{fig:epSOS_architecture}.




\section{The Portuguese Electronic Health Record}

The next subsections are intended to describe the way all the projects are supposed to be connected and to share clinical data. The section starts with the recent developments and then presents the vision that the authors built from the research done in the last months.

\subsection{Recent Developments}

Through the last months, some developments were done in order to integrate the several data and systems existing. This section aims to state the work done and the problems that were raised.

\subsubsection{The Professional Portal}
The Professional Portal aims to be the gate through which the doctors will be able to access the clinical information about a patient. In this system, it is intended to gather the information coming from the Patient Portal (introduced by the referenced patient) but also the information stored at other institutions like primary healthcare institutions and hospitals. In this sense, it was necessary to think how it would be possible to integrate the data from two different sources:

Since that the SAM application has a web interface, and it is installed in a significant percentage of the hospitals and primary care institutions, the quicker solution found was to allow the clinicians to directly access the system in order to consult the information. However, to accomplish that, it is necessary that each institutions publishes that service to the public health information network (RIS - Rede de Informação da Saúde). Basically, the work-flow (Fig. \ref{fig:PDSi1-SAMSAM}) would be something like this:
\begin{enumerate}
\item the clinician at local institution is using SAM to access the local episode and patient information;
\item the clinician clicks in link that takes him to the Professional Portal;
\item the clinician selects one institution accessing directly to the SAM of that institution to consult the information.
\end{enumerate}

\mycustomfigure{PDSi1-SAMSAM}{Control flow for the process of a clinician accessing information in other healthcare institution with SAM system}{width=10cm}

\subsubsection{Discussion}

In order to achieve this kind of work-flow is necessary to modify: first, the SAM application introducing the link to the Professional Portal; second, the institutions' infrastructure to allow external connections to their SAM system. Since SAM was developed within the Ministry of Health, the first part was relatively easy to accomplish. On the other hand, the second part is much more difficult than initially estimated:
\begin{itemize}
\item it is inconceivable to configure n-to-n permissions so that each institution is able to access all the others. So, the logical solution is to make the request pass through the PDS (Plataforma de Dados da Saúde). With this option, from the target institution point of view the request comes always from PDS, and that is the only external platform to have access to the system;
\item the PDS has to provide a tunnelling service handling the request and the reply, something that can be very heavy when working country-wide.
\end{itemize}

%TODO inserir figura para explicitar o work-flow presente no resumo da reuniao 28022012


\subsection{Future vision}

In the Section \ref{sec:arch-styles} we referred some architectural styles that could be interesting to this work. When working with complex projects like this, the solution is always an aggregate of smaller solutions. That means that is not possible to simple apply one model or one style but a composition of several. About the styles that we have studied, we can retain some guides and understand what problems they can solve and where we should use them.

A previous study~\citep{Carvalho2011a} advocates the match between the Metropolis Model and the Portuguese healthcare national system. In fact, the authors believes the match is possible. However, the urgency for results prevents the try for a completely fit of the model. Nevertheless, there are several principles that it is possible to extract and apply to the current model. In the next few subsections, we will overview some principles that might be adopted from the studied models.


\subsubsection{Definition of kernel's scope}

The Portuguese EHR project was renamed to \textit{Plataforma de Dados da Saúde}\footnote{Healthcare Data Platform} (PDS). The recent developments under the sign of PDS has led to the releasing of two systems: the Patient Portal - My Notes and the Professional Portal. However, these two systems were developed almost as independent systems, with their own user interfaces, architecture, technologies and even implemented by different institutions (as represented at Fig. \ref{fig:evolution-phase1}).

\mycustomfigure{evolution-phase1}{The actual situation with the two portals}{width=10cm}

In order to became a real platform for sharing clinical data, the PDS should evolve with a well delimited scope. Following some principles of the Metropolis Model (see Sec. \ref{sec:metro-model}) it is possible to formulate the next suggestions:
\begin{itemize}
\item delimit the scope of PDS to a platform for sharing data;
\item split the logical domain from the presentation one.
\end{itemize}

The objective is to transform the two applications so that the two existing interfaces became only the official clients to the clinical information repository (PDS), in the case, the official ones. To achieve this, it is necessary to clearly separate the two domains, defining web services that are used to query and retrieve data, like represented at Fig. \ref{fig:evolution-phase2}.

\mycustomfigure{evolution-phase2}{The recommended approach, creating well-separated logic and interface domains}{width=10cm}

This strategy meets the Metropolis Model principles since we are trying to create a smaller but more robust kernel of clinical information. At the same time, it allows to transform those interfaces into open interfaces. By doing that, many stakeholders would have the opportunity (Fig. \ref{fig:evolution-phase3}) to: 
\begin{itemize}
\item develop new applications using the existing services provided directly by the Ministry;
\item integrate the information in the work-flow of the existing information systems.
\end{itemize}

The most significant part is that, the power and investment of the companies would create significant value to the patients, even with the Ministry spending no money unless the effort to provide and define the services. Sometimes, when talking about crowd-sourced where the information is the fundamental, it is not necessary to do high investment but to provide the right tools to the interested parties.

\mycustomfigure{evolution-phase3}{The possibilities created by opening the interfaces to other stakeholders}{width=10cm}

\subsubsection{Internal organization}

The PDS is expected to became a really huge system. In that sense, the way it is internally organized is fundamental to allow the addition of new services to fit new requirements. The Service-oriented Architectures (Section \ref{sec:soa}) appear as an interesting solution to solve the scalability and complexity issues.

There are some PDS components that are easily identified as potential services, for instance:
\begin{itemize}
\item Data Anonymizer - receives some data and returns it without being possible to reveal the patient identity;
\item Data Dispatch Manager - receives the data to be transferred to some institution and assures that it arrives the destination;
\item RCU2 Manager - important component to manage all the actions performed that are related with RCU2. It might be an example of a service composed by internal services itself.
\end{itemize}


\subsubsection{The event handling}

In the Section \ref{sec:eda} we have shortly described the Event-oriented Architectures and obviously, it was on purpose. The healthcare reality is a area characterized by several events, an emergency situation, a surgery, a complementary exam, etc. In fact, each episode is an event that has information attached and that is relevant to someone, either a patient, a doctor or even an institution. In this sense, it is important to understand how is it possible to fit this model in a very complex context. In terms of medium-term vision, the situations triggered as events are:
\begin{itemize}
\item the family doctor needs to get warned about new information of its patients, to include in the RCU2;
\item some national institutions (e.g. \textit{Instituto Nacional de Estatística}\footnote{Statistical National Institute} (INE) or \textit{Direção-Geral de Saúde}\footnote{Overall Direction of Health} (DGS)) are interested in receiving information.
\end{itemize}

\mycustomfigure{pds-eda}{The application of an EDA in the context of PDS}{scale=0.75}

The use of an event-oriented architecture would be like (Fig. \ref{fig:pds-eda}):
\begin{enumerate}
\item the national clients manifests interest in received some kind of information at PDS;
\item the subscription service registers the interested clients;
\item when an event arrives at PDS, the subscription service forwards it to the interested parties.
\end{enumerate}

In summary, it consists in the creation of a specific service inside PDS, that would be responsible for managing the subscriptions that the institutions do. Moreover, the family doctors would also be automatically registered to receive notifications about the new proposals for the their patients RCU2.

Since we are talking about triggering and handling events, the use of HL7 V2 (Section~\ref{sec:hl7-v2}) might facilitate the data transfer between the local institutions and the services above (e.g. Subscription Service). Such as described in the referred section, in addition of HL7 V2 being an event-oriented standard it is also an excellent way of sending small portions of data.


\subsubsection{Healthcare Professional Identity Provider}\label{sec:hpip}

An Healthcare Professional Identity Provider could help to solve some significant problems in the Portuguese health area. In fact, this problem must be divided in two different issues. The first and most important has to do with the creation of a health professionals national record as it exists to the patients, the \textit{Registo Nacional de Utentes}\footnote{Patients National Record} (RNU). The aim of the system would be to store all the professionals working in the healthcare services, helping the Ministry and its information system particularly.

The second issue is the creation of an identity provider certifying that one individual is actually an authenticated and authorized healthcare professional and must be able to access some kind of information.

The urgency for this record is recognized amongst the professionals working in the Ministry's information systems. However, despite of the importance that that kind of record might bring to the systems development, it is not recognized by the superior instances since that it is not a project with enough visibility.


%TODO review
%The healthcare professionals have to deal and work with several applications

%As aplicações são enumeradas, descritas e classificadas segundo diversos critérios. O seu papel na Arquitectura da Informação é claro e definido, as suas funções têm fronteiras e interfaces expostos ao resto das aplicações como serviços ou componentes reutilizáveis.

%TODO inserir figura relativa aos standards utilizados dentro e fora da PDS
%TODO falar sobre a aplicação ao publico com objectivo de estender ao privado
%TODO falar instituções que não registam electronicamente

\section{Architecture Overview}

The overview is constituted by four essential modules. The entity responsible (CIC) for planning this change process defined the following projects:
\begin{itemize}
\item \textit{Portal do Utente (as minhas notas)} -- the Portuguese PHR;
\item \textit{Resumo Clínico Único do Utente} -- the Portuguese Patient Summary;
\item epSOS integration -- \textit{Portal Internacional} and the RCU2 availability abroad the country;
\item \textit{Portal do Profissional} -- the portal where the professionals access the patient clinical data.
\end{itemize}

All these projects are supposed to be interconnected by a platform created with that goal and named \textit{Pla\-ta\-for\-ma de Dados de Saúde} (PDS). The future vision, represented by the Figure~\ref{fig:general_architecture} is based on limiting the scope of PDS to the minimum, removing all the user interfaces clients from its scope. To do this, it is necessary to implement services that those clients interface can use to present the information. This way, it is possible in future to open that services to other stakeholders, letting them construct alternatives to the official clients and new ways of using that information. These future ``investors'' may be companies that build software to the healthcare arena as well as private healthcare institutions.


The obvious response to the problem of exchanging clinical information is using well-known standards. Although, in the chaotic context of several systems and applications not talking with each other that is not a reasonable answer. So, having this scenario into account it is possible to point out these guidelines:
\begin{itemize}
\item the systems in development process or the systems yet to come should be built under some existing international standard;
\item the data that is sent out from the PDS should use standards and interfaces completely defined and clear;
\item the data flow inside the PDS may not be using standards if that option clearly brings benefits;
\item regarding the existing systems, a process for adopting some standard should be done with small accomplishments, step by step.
\end{itemize}

The next tables help to understand the state of the four essential components. 

\mysummary{sum-phr}{Summary of \textit{Portal do Utente - as minhas notas}}
{ completely new system (website) to be integrated with the existing ones & definition of services for retrieving the data }
{ centralized repository of clinical self-introduced information and patient consent & new types of consents; new functionalities allowing the introduction of more information; store the data using a standard }
{ - & web services implementing IHE profiles }

\mysummary{sum-rcu2}{Summary of RCU2}
{new background system to provide access to the RCU2 & well defined interfaces to retrieve and manage the RCU2 }
{selection of important information; definition of data model; 
to be implemented at a CSP level by CNPD imposition; document managed by the family doctor &
group the RCU2 into real data warehouses by regions with reliable backup systems; }
{to be stored at the CSP servers & - }

\mysummary{sum-epsos}{Summary of epSOS project}
{ designing and discussing the new background system and the \textit{Portal Internacional} & integrate the National Connector into the PDS }
{ completely dependent of other services like \textit{Portal do Utente} or RCU2 & - }
{ - & define the services of NC using IHE profiles; necessity for an Healthcare Professional Identity Provider }


\begin{landscape}
\centering     % optional, probably makes it look better to have it centered on the page
\mycustomfigure{general_architecture}{General view of the architecture future vision}{height=0.99\textheight}
\end{landscape}

%\mysummary{sum-pds}{Summary of PDS and \textit{Portal do Professional}}
%{}
%{zxcvxzc}
%{czxc}